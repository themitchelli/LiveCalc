{
  "id": "PRD-LC-014",
  "title": "Project Standards & Architecture Documentation",
  "type": "documentation",
  "priority": "high",
  "status": "planned",
  "created": "2026-01-24",
  "project": "LiveCalc",
  "phase": 1,
  "description": "Establish comprehensive project standards, coding conventions, and architectural documentation in FADE.md and standards/ directory. Ensures all future PRDs and development sessions have clear, unambiguous guidance on LiveCalc-specific principles, constraints, and patterns.",
  "problem": [
    "FADE.md contains generic placeholder content, not LiveCalc-specific context",
    "No standards/*.md files exist despite being referenced in FADE.md",
    "Critical architectural constraints (16-byte alignment, vanilla JS, API-first) not documented",
    "New developers and AI agents lack clear guidance on project conventions",
    "Risk of conflicting standards between documentation sources"
  ],
  "solution": [
    "Update FADE.md with LiveCalc project overview, tech stack, and architecture",
    "Create standards/coding.md with language-specific conventions and comment philosophy",
    "Create standards/api-security.md with security-by-design principles",
    "Create standards/infrastructure.md with 'X as code' requirements",
    "Create standards/testing.md with performance benchmarking requirements",
    "Create standards/git.md with commit conventions and branch strategy",
    "Document all architectural constraints discovered in PRD-LC-001 through PRD-LC-010"
  ],
  "dependencies": [],
  "technicalNotes": {
    "fileFormat": "Markdown with YAML frontmatter for discoverability",
    "structure": "Principle → Rationale → Examples pattern for each standard",
    "references": "Link to external standards (Google Style Guide, PEP 8) rather than duplicate",
    "validation": "Ensure no conflicting guidance between files"
  },
  "userStories": [
    {
      "id": "US-STD-01",
      "title": "LiveCalc-Specific FADE.md",
      "story": "As a developer or AI agent, I want FADE.md to accurately describe LiveCalc's architecture so I understand project context before working.",
      "acceptanceCriteria": [
        "Project Overview section describes LiveCalc's purpose: instant actuarial model feedback with WASM engine",
        "Tech Stack section lists: C++ (engine), TypeScript (extension), Python (cloud API), WASM (Emscripten)",
        "Architecture diagram shows: VS Code Extension → WASM Engine ← SharedArrayBuffer → Worker Pool",
        "Repository link points to github.com/themitchelli/LiveCalc",
        "Target Architecture section includes: API-first design, bus:// protocol, CalcEngine interface, zero-copy parallelism",
        "Fragile Areas section removed (no known fragile code yet)",
        "Off-Limits Modules section includes: livecalc-engine/cpp/build/ (generated), node_modules/ (dependencies)",
        "Session Boundaries clarified: allowed (create features, tests, docs), requires approval (cloud infrastructure changes), never (commit secrets, modify vendor code)"
      ],
      "passes": true
    },
    {
      "id": "US-STD-02",
      "title": "Coding Standards",
      "story": "As a developer, I want clear coding standards so my code is consistent with the project style.",
      "acceptanceCriteria": [
        "standards/coding.md created",
        "References external style guides: Google TypeScript Guide, PEP 8, C++ Core Guidelines",
        "Comment philosophy documented: 'Leave clear comments for ambiguous or non-obvious code. Do not over-comment self-documenting code. Respect human developers by assuming competence.'",
        "LiveCalc-specific conventions:",
        "  - TypeScript: camelCase for functions/variables, PascalCase for classes, UPPER_CASE for constants",
        "  - C++: snake_case for functions/variables (matches actuarial convention), PascalCase for classes",
        "  - Python: PEP 8 snake_case throughout",
        "  - Naming: Use domain terms (policies, assumptions, projections) not generic terms (items, data, values)",
        "SIMD alignment requirement documented: 'All SharedArrayBuffer allocations must be 16-byte aligned (not 8-byte) for SIMD compatibility. Use alignas(16) in C++.'",
        "CalcEngine interface requirement: 'All calculation engines must implement CalcEngine interface (initialize, runChunk, dispose)'",
        "Error handling: 'Throw exceptions with descriptive messages in C++/TypeScript. Return error codes in hot-path WASM functions for performance.'",
        "File organization: 'Group by feature (pipeline/, assumptions-manager/) not by type (models/, services/)'",
        "No conflicting guidance with other standards files"
      ],
      "passes": true
    },
    {
      "id": "US-STD-03",
      "title": "API & Security Standards",
      "story": "As a developer, I want security-by-design principles documented so all APIs are built securely from the start.",
      "acceptanceCriteria": [
        "standards/api-security.md created",
        "API-First Strategy documented: 'Design OpenAPI/Swagger specification before implementation. All cloud services expose REST APIs. VS Code integration consumes these APIs.'",
        "Security by Design principle: 'Privacy and security are architectural requirements, not afterthoughts. All data flows must consider: authentication, authorization, encryption, audit logging.'",
        "Authentication requirements:",
        "  - JWT Bearer tokens for cloud API",
        "  - Token validation against Assumptions Manager JWKS endpoint",
        "  - Short-lived tokens (1 hour max)",
        "  - Refresh token rotation",
        "Authorization requirements:",
        "  - Tenant isolation: users can only access their own data",
        "  - Resource scoping: SAS tokens limited to tenant prefix",
        "  - Quota enforcement: prevent resource exhaustion",
        "Data protection:",
        "  - TLS 1.3 for all network traffic",
        "  - Encryption at rest for blob storage",
        "  - No secrets in code/config (use Azure Key Vault)",
        "  - Audit logging for all tenant actions",
        "Input validation: 'Validate at system boundaries (API endpoints, file uploads). Trust internal interfaces. Fail fast with clear error messages.'",
        "Error handling: 'Never expose stack traces or internal paths in API responses. Log detailed errors server-side, return generic messages to clients.'",
        "Rate limiting: 'Implement per-tenant rate limits to prevent abuse'",
        "CORS policy: 'Explicitly allow VS Code extension origin, deny all others'"
      ],
      "passes": true
    },
    {
      "id": "US-STD-04",
      "title": "Infrastructure as Code Standards",
      "story": "As a platform engineer, I want infrastructure-as-code standards so all environments are reproducible and auditable.",
      "acceptanceCriteria": [
        "standards/infrastructure.md created",
        "'Everything as Code' principle documented: 'All changeable components must be defined as code and deployed through automation. This includes: infrastructure (Terraform), configuration (JSON/YAML), secrets (Key Vault references), monitoring (Prometheus rules), documentation (Markdown).'",
        "Terraform requirements:",
        "  - Use Terraform for all Azure infrastructure",
        "  - State stored in Azure Storage with locking",
        "  - Separate state files per environment (dev, staging, prod)",
        "  - Modules for reusable components (AKS cluster, storage account)",
        "  - Variables for environment-specific values (no hardcoding)",
        "  - Outputs for resource IDs needed by downstream tools",
        "Configuration management:",
        "  - Environment config in values-{env}.yaml files",
        "  - Secrets referenced from Key Vault (never inline)",
        "  - Feature flags in config files (not environment variables)",
        "  - Schema validation for all config files (JSON Schema)",
        "Deployment automation:",
        "  - GitHub Actions for CI/CD",
        "  - Helm charts for Kubernetes deployments",
        "  - Automated testing before deployment (linting, unit tests, integration tests)",
        "  - Blue/green or rolling updates (zero downtime)",
        "Immutable infrastructure: 'Replace, do not modify. Container images are immutable. Infrastructure changes create new resources.'",
        "Version control: 'All code, config, and IaC in Git. Tag releases with semantic versioning.'",
        "Documentation as Code: 'API specs in OpenAPI YAML. Architecture diagrams in Mermaid/PlantUML. Keep docs in repo, not external wiki.'"
      ],
      "passes": true
    },
    {
      "id": "US-STD-05",
      "title": "Testing & Performance Standards",
      "story": "As a developer, I want testing standards that include performance benchmarks so regressions are caught automatically.",
      "acceptanceCriteria": [
        "standards/testing.md created",
        "Test pyramid documented: 'Many unit tests (70%), some integration tests (25%), few E2E tests (5%)'",
        "Unit test requirements:",
        "  - Co-located with source: same directory as *.test.ts or *_test.py",
        "  - AAA pattern: Arrange, Act, Assert",
        "  - Descriptive names: test_scenario_expectedBehavior or 'should do X when Y'",
        "  - Fast: unit tests complete in <100ms each",
        "  - Isolated: no shared state, no external dependencies",
        "Integration test requirements:",
        "  - Test component interactions (API → worker, extension → engine)",
        "  - Use test doubles for slow/flaky external services",
        "  - Tests in tests/ directory at project root",
        "Performance benchmark requirements:",
        "  - All performance-sensitive PRDs include benchmark targets in Definition of Done",
        "  - Regression tests protect established benchmarks",
        "  - Current benchmarks (from SPIKE-LC-007):",
        "    * 10K × 1K multi-thread: ~370ms (5.4x speedup)",
        "    * 100K × 1K multi-thread: ~3s (32M proj/sec)",
        "    * 1M × 1K multi-thread: ~36s (27M proj/sec)",
        "  - New features must not regress these targets by >10%",
        "  - Benchmark script: npm run benchmark in livecalc-engine/js",
        "Regression test requirements:",
        "  - All PRDs must maintain passing tests from previous PRDs",
        "  - Test suite runs on every commit (GitHub Actions)",
        "  - Failed regression tests block merge to main",
        "Coverage requirements:",
        "  - Target: 80% line coverage for new code",
        "  - Not a hard requirement: prefer meaningful tests over coverage percentage",
        "  - Exclude generated code (WASM bindings, Protobuf) from coverage",
        "Test organization:",
        "  - Unit tests: same directory as source",
        "  - Integration tests: tests/integration/",
        "  - E2E tests: tests/e2e/",
        "  - Benchmark tests: tests/benchmarks/",
        "Mocking strategy: 'Mock at boundaries (file system, network). Do not mock internal business logic.'"
      ],
      "passes": true
    },
    {
      "id": "US-STD-06",
      "title": "Git & Documentation Standards",
      "story": "As a team member, I want Git and documentation standards so commit history is clear and docs stay up-to-date.",
      "acceptanceCriteria": [
        "standards/git.md created",
        "Commit message format: 'Use Conventional Commits: feat: / fix: / chore: / docs: / test: / refactor:'",
        "Commit message examples:",
        "  - 'feat: add remote step-through debugging API (PRD-LC-012 US-API-04)'",
        "  - 'fix: prevent race condition in SAB offset allocation (PRD-LC-010 US-002)'",
        "  - 'chore: upgrade TypeScript to 5.3.2'",
        "  - 'docs: update FADE.md with architecture diagram'",
        "Commit atomicity: 'One logical change per commit. If you can't describe it in one sentence, split it.'",
        "Branch naming:",
        "  - feature/PRD-LC-XXX-short-description",
        "  - fix/issue-description",
        "  - spike/exploration-topic",
        "  - chore/maintenance-task",
        "Branch lifecycle:",
        "  - Create feature branch from main",
        "  - Develop and test locally",
        "  - Push to origin, create PR",
        "  - Merge to main after review/tests pass",
        "  - Delete branch after merge",
        "PR requirements:",
        "  - Title references PRD ID (if applicable)",
        "  - Description summarizes changes and rationale",
        "  - All tests pass",
        "  - Code review from human (if available) or AI validation",
        "FADE-specific conventions:",
        "  - Co-authored commits: 'Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>'",
        "  - PRD completion commits: 'feat: complete PRD-LC-XXX - Title (reference)'",
        "  - Never commit to main directly (except initial setup)",
        "standards/documentation.md created",
        "Documentation philosophy: 'Documentation is code. It lives in the repo, versioned with the code it describes.'",
        "README requirements:",
        "  - Every package has README.md with: purpose, quick start, development setup, testing, deployment",
        "  - Project root README: high-level overview, monorepo structure, getting started",
        "API documentation:",
        "  - OpenAPI/Swagger specs for all REST APIs",
        "  - Generated from spec, not manually written",
        "  - Kept in sync via CI validation",
        "Code comments:",
        "  - When to comment: 'Why' (rationale, constraints, non-obvious decisions)",
        "  - When not to comment: 'What' (self-documenting code, obvious logic)",
        "  - Example of good comment: '// 16-byte alignment required for SIMD compatibility'",
        "  - Example of bad comment: '// Increment counter by one' (obvious)",
        "Architecture docs:",
        "  - High-level in FADE.md",
        "  - Detailed design in docs/ directory",
        "  - Diagrams in Mermaid or ASCII art (not binary images)",
        "PRD documentation:",
        "  - Canonical source in fade/prds/",
        "  - Completed PRDs archived to fade/prd-archive/",
        "  - Definition of Done includes 'Documentation updated'",
        "Changelog: 'Maintain CHANGELOG.md at project root following Keep a Changelog format'"
      ],
      "passes": true
    }
  ],
  "filesToCreate": [
    "standards/coding.md",
    "standards/api-security.md",
    "standards/infrastructure.md",
    "standards/testing.md",
    "standards/git.md",
    "standards/documentation.md"
  ],
  "filesToModify": [
    {
      "file": "FADE.md",
      "changes": "Update with LiveCalc-specific project overview, tech stack, architecture, target patterns, and session boundaries"
    }
  ],
  "definitionOfDone": [
    "FADE.md accurately describes LiveCalc project (not generic template)",
    "All 6 standards/*.md files created with comprehensive guidance",
    "No conflicting standards between files (validated by reading all files)",
    "Architecture diagram in FADE.md shows current system (VS Code + WASM + Workers)",
    "All critical constraints documented (16-byte alignment, CalcEngine interface, API-first)",
    "Security-by-design principles clearly stated",
    "Everything-as-code requirements documented",
    "Performance benchmark requirements included in testing standards",
    "Comment philosophy clearly explained (clear for ambiguous, don't over-comment)",
    "Git commit conventions documented with examples",
    "Documentation reviewed for clarity and completeness"
  ],
  "successCriteria": {
    "mustHave": [
      "FADE.md project overview complete",
      "All referenced standards files exist",
      "API-first strategy documented",
      "Security-by-design principles documented",
      "Everything-as-code requirements documented",
      "No conflicting guidance"
    ],
    "niceToHave": [
      "ADR (Architecture Decision Record) template",
      "Onboarding checklist for new developers",
      "Troubleshooting guide for common issues"
    ]
  },
  "estimatedSessions": "1 FADE session",
  "risks": [
    {
      "risk": "Standards too prescriptive, inhibit innovation",
      "likelihood": "low",
      "impact": "medium",
      "mitigation": "Focus on principles over rules. Use 'prefer X' not 'must X' for non-critical items"
    },
    {
      "risk": "Standards conflict with external guides (Google, PEP 8)",
      "likelihood": "low",
      "impact": "low",
      "mitigation": "Reference external guides, only override when LiveCalc-specific constraint requires it"
    },
    {
      "risk": "Documentation becomes stale as code evolves",
      "likelihood": "medium",
      "impact": "medium",
      "mitigation": "Include 'Update documentation' in Definition of Done for all PRDs. Treat docs as code (review, version control)"
    }
  ]
}
